/**
 * @accede-web/select - 
 * @version v0.0.0
 * @link undefined
 * @license undefined
 **/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Select=e()}(this,function(){"use strict";var t=function(){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}}(),e=[13,27,32,35,36,37,38,39,40];return function(){function i(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this._options=Object.assign({activeClass:"active",template:this._template},e),this._handleChange=this._handleChange.bind(this),this._handleClick=this._handleClick.bind(this),this._handleClose=this._handleClose.bind(this),this._handleKey=this._handleKey.bind(this),this._select=t,this._root=this._select.parentElement,this._parse(),this._create(),this._append(),this._getMaxWidth(),document.body.addEventListener("click",this._handleClose),document.body.addEventListener("focus",this._handleClose,!0),this._button.addEventListener("click",this._handleClick),this._listbox.addEventListener("click",this._handleClick),this._button.addEventListener("keydown",this._handleKey),this._listbox.addEventListener("keydown",this._handleKey)}return t(i,[{key:"_append",value:function(){var e=this._select.parentElement;Array.from(this._dom.children).forEach(function(t){e.appendChild(t)})}},{key:"_create",value:function(){var a=this,n=this._selectOptions.length;this._dom=document.createDocumentFragment(),this._button=document.createElement("button"),this._button.setAttribute("aria-haspopup","listbox"),this._button.setAttribute("aria-expanded","false"),this._button.setAttribute("type","button"),this.label&&this._button.setAttribute("aria-labelledby",this.label.id);var t=this._options.template(-1<this.selectedIndex?this._selectOptions[this.selectedIndex].label:"","button");this._button.innerHTML="<span>"+t+"</span>",this._dom.appendChild(this._button),this._listbox=document.createElement("ul"),this._listbox.setAttribute("role","listbox"),this._listbox.setAttribute("aria-hidden","true"),this._listbox.setAttribute("tabindex","-1"),this.label&&this._listbox.setAttribute("aria-labelledby",this.label.id),this.multiple&&this._listbox.setAttribute("aria-multiselectable","true"),this._dom.appendChild(this._listbox);var l=this._selectGroups.map(function(t,e){var i=document.createElement("li"),s=document.createElement("ul"),n=document.createElement("p"),l=(a._select.name||a._options.name)+"-group-"+e;return i.appendChild(n),i.appendChild(s),i.setAttribute("role","group"),i.setAttribute("aria-labelledby",l),s.setAttribute("role","presentation"),n.setAttribute("id",l),n.setAttribute("role","presentation"),n.classList.add("optgroup"),n.innerHTML=a._options.template(t.label,t.nodeName.toLowerCase()),i}),o=l.length;this.listOptions=this._selectOptions.map(function(t,e){var i=document.createElement("li");if(i.setAttribute("role","option"),i.setAttribute("id",(a._select.name||a._options.name)+"-"+e),o&&(i.setAttribute("aria-setsize",n),i.setAttribute("aria-posinset",e+1)),e===a.selectedIndex&&i.setAttribute("aria-selected","true"),i.innerHTML=a._options.template(t.label,t.nodeName.toLowerCase()),"OPTGROUP"===t.parentElement.nodeName){var s=l[a._selectGroups.indexOf(t.parentElement)];s.children[1].appendChild(i),a._listbox.contains(s)||a._listbox.appendChild(s)}else a._listbox.appendChild(i);return i})}},{key:"_focus",value:function(t){var e=this._activeIndex+t,i=this.listOptions.length-1;e<0?e=i:i<e&&(e=0);var s=this.listOptions[e],n=this.listOptions[this._activeIndex];n.classList.remove(this._options.activeClass),n.removeAttribute("tabindex"),s.classList.add(this._options.activeClass),s.setAttribute("tabindex",-1),s.focus(),this._listbox.setAttribute("aria-activedescendant",s.id),this._activeIndex=e}},{key:"_getMaxWidth",value:function(){this._listbox.style.visibility="hidden",this._listbox.style.display="block",this._listbox.style.width="auto",this.width=this._listbox.clientWidth,this._listbox.removeAttribute("style"),this._button.firstElementChild.style.width=this.width+"px"}},{key:"_handleChange",value:function(){this.selectedIndex=this._select.selectedIndex}},{key:"_handleClick",value:function(t){1===t.detail&&(this._button.contains(t.target)?this._handleExpand():this._listbox.contains(t.target)&&this._handleSelection(t))}},{key:"_handleClose",value:function(t){this._root.contains(t.target)||this._handleExpand(!1)}},{key:"_handleExpand",value:function(t){var e=void 0!==t?!t:"true"===this._button.getAttribute("aria-expanded");this._button.setAttribute("aria-expanded",!e),this._listbox.setAttribute("aria-hidden",e);var i=this.listOptions[this._activeIndex];i.classList.toggle(this._options.activeClass,!e),e||i.removeAttribute("tabindex")}},{key:"_handleKey",value:function(t){if(-1!==e.indexOf(t.keyCode)){if(t.preventDefault(),27===t.keyCode)return this._handleExpand(!1),void this._button.focus();if(13===t.keyCode)return this._button.contains(t.target)?(this._handleExpand(),void this._listbox.focus()):void this._selectIndex(this._activeIndex);if(32!==t.keyCode||this._button.contains(t.target))return 37<=t.keyCode&&t.keyCode<=40?this._button.contains(t.target)?(this._handleExpand(),void this._listbox.focus()):void this._focus(t.keyCode<39?-1:1):void 0;this.multiple?this._toggleOption(this.listOptions[this._activeIndex],this._activeIndex):this.selectedIndex=this._activeIndex}}},{key:"_handleSelection",value:function(e){var t=this.listOptions.findIndex(function(t){return t.contains(e.target)});t<0||this._selectIndex(t)}},{key:"_parse",value:function(){this._selectOptions=Array.prototype.slice.call(this._select.options),this.size=this._select.size,this.multiple=this._select.multiple,this._selectedIndex=this._select.selectedIndex,this._activeIndex=this._selectedIndex<0?0:this._selectedIndex,this.label=document.querySelector("[for="+this._select.id+"]"),this.label&&!this.label.id&&this.label.setAttribute("id",this._select.name+"-label"),this._selectGroups=Array.prototype.slice.call(this._select.querySelectorAll("optgroup"))}},{key:"_selectIndex",value:function(t){this.multiple?this._toggleOption(this.listOptions[t],t):(this.selectedIndex=t,this._handleExpand(!1),this._button.focus())}},{key:"_template",value:function(t){return t}},{key:"_toggleOption",value:function(t,e){t.hasAttribute("aria-selected")?t.removeAttribute("aria-selected"):this.selectedIndex=e}},{key:"options",get:function(){return this._selectOptions}},{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(t){if(this.listOptions){this.multiple||this.listOptions[this._selectedIndex].removeAttribute("aria-selected"),this._select.selectedIndex=t,this._selectedIndex=t,this.listOptions[this._select.selectedIndex].setAttribute("aria-selected","true");var e=this._options.template(-1<this.selectedIndex?this._selectOptions[this.selectedIndex].label:"","button");this._button.firstElementChild.innerHTML=e}}}]),i}()});
